<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}
{% block extra_title %}
- Planning
{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'planning/css/planning.css' %}">
{% endblock %}
{% block content %}
<header>
    <nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-dark">
        <a class="navbar-brand" href="#">EggBox</a>
        <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown"
            aria-expanded="false"
            aria-label="Toggle navigation"
            >
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="{% url 'planning' %}">Planning</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'coaching' %}">Coaching</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'notifications' %}">Messages</a>
                </li>
            </ul>
        </div>
        <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{ profile.first_name }} {{ profile.last_name }}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                {% if profile.level == 'admin' or profile.level == 'manager' %}
                <a class="dropdown-item" href="{% url 'user_management' %}">User Management</a>
                <a class="dropdown-item" href="{% url 'teams' %}">Teams</a>
                <a class="dropdown-item" href="{% url 'roles' %}">Roles</a>
                <a class="dropdown-item" href="{% url 'shifts' %}">Shifts</a>
                <div class="dropdown-divider"></div>
                {% endif %}
                <a class="dropdown-item" href="{% url 'profile' %}">My Profile</a>
                {% if profile.level == 'admin' %}
                <a class="dropdown-item" href="{% url 'settings_global' %}">Global Settings</a>
                {% endif %}
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'account_logout' %}">Logout</a>
            </div>
        </div>
    </nav>
</header>
<section class="section-maincontent">

<!-- check if there are any users. Otherwise show welcome message + tips -->
{% if users_select %}
    <div class="month-navigation">
        <div class="row">
            <div class="col-12 col-sm-4">
                <h2 id="month-title">Month</h2>
            </div>
            <div class="col-12 col-sm-4 text-center">
                <a class="control-btn" href="{% url 'planning' %}?month={{ nav_month.previous }}"><i class="fas fa-arrow-alt-circle-left"></i></a>
                <a class="control-btn" href="{% url 'planning' %}?month={{ nav_month.next }}"><i class="fas fa-arrow-alt-circle-right"></i></a>
                <a class="control-btn" href="{% url 'planning' %}?month=0"> <i class="fas fa-home"></i></a>
                <a class="control-btn create-event-btn btn-inactive" data-toggle="modal" data-target="#newEventModal" href="#!"><i class="fas fa-edit"></i></a>
                <a class="control-btn jcopy-btn btn-inactive" href="#!"> <i class="fas fa-copy"></i></a>
            </div>
            <div class="col-12 col-sm-4 text-right">
                <div id="team-selector-wrapper">
                <!-- Team selector - only show if more than 1 team -->
                {% if teams.count > 1 %}
                <div class="dropdown show">
                    <a class="dropdown-toggle" href="#" role="button" id="teams_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {{ current_team }}
                    </a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        {% for team in teams %}
                        <a class="dropdown-item" href="{% url 'planning' %}?team={{ team.team_name }}">{{ team.team_name }}</a>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                {{ current_team }}
                {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="table-container">
        <div class="month-table" id="weeks-container">
            <!-- JS magic -->
        </div>
    </div>
    {% if profile.level == 'agent' %}
        You are working xx/xx hours this month. (Submit planning link)
    {% endif %}
{% else %}
    {% include 'planning/includes/welcome.html' %}
{% endif %}
</section>
<div class="modal fade" id="newEventModal" tabindex="-1" role="dialog" aria-labelledby="newEventModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="newEventModalLabel">New event</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post">
        {% csrf_token %}
            <label for="sel-category">Category:</label><br>
            <select id="sel-category" name="category">
                <option value="work">Work</option>
                <option value="training">Training</option>
                <option value="meeting">Meeting</option>
                <option value="holidays">Holidays</option>
                <option value="sick">Sick</option>
                <option value="leave">Leave</option>
                <option value="lunch">Lunch break</option>
                <option value="dinner">Dinner break</option>
                <option value="break">Paid break</option>
                <option value="absence">Absence</option>
            </select>
            <br>
            <label for="fname">Start time:</label><br>
            <input type="time" name="start_time" value="08:00"><br>
            <label for="lname">End time:</label><br>
            <input type="time" name="end_time" value="17:00"><br>
            <label for="sel-role">Agent Role</label><br>
            <select id="sel-role" name="role">
            {% for role in roles %}
                {% if profile.role == role %}
                    <option value="{{ role }}" selected>{{ role }}</option>
                {% else %}
                    <option value="{{ role }}">{{ role }}</option>
                {% endif %}
            {% endfor %}
            </select>
            <br>
            <input type="hidden" id="hidden-day" name="day" value="0">
            {% if profile.level == 'admin' or profile.level == 'manager' %}
                <label for="sel-user">Select a user</label><br>
                <select id="sel-user" name="user_id">
                    {% for user in users_select %}
                        <option value="{{ user.id }}">{{ user.first_name }} {{ user.last_name }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="status" value="1">
            {% else %}
                <input type="hidden" name="user_id" value="{{ profile.id }}">
                <input type="hidden" name="status" value="0">
            {% endif %}
            <input type="submit" value="Submit">
        </form>
      </div>
    </div>
  </div>
</div>


{% endblock %}
{% block postloadjs %}
{{ block.super }}
{% include 'planning/includes/calendar_script.html' %}
{% endblock %}